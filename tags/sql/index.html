<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>Tag: sql | å®…è°ˆ</title>
    <meta name="keywords" content="hexo,theme,otakism,otaku"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="google-site-verification" content=""/>
    <meta name="baidu-site-verification" content=""/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="ä½ è¿˜åœ¨æœŸå¾…ç€ä»€ä¹ˆï¼Ÿ">
<meta property="og:type" content="website">
<meta property="og:title" content="å®…è°ˆ">
<meta property="og:url" content="http://example.com/tags/sql/index.html">
<meta property="og:site_name" content="å®…è°ˆ">
<meta property="og:description" content="ä½ è¿˜åœ¨æœŸå¾…ç€ä»€ä¹ˆï¼Ÿ">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Freere-Aoki">
<meta name="twitter:card" content="summary">
    

    <!-- Favicon -->
    

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata|Roboto:300,400,700" rel="stylesheet">

    
<link rel="stylesheet" href="/style.css">

    <script>
      function setLoadingBarProgress(num) {
        document.getElementById('loading-bar').style.width = num + "%";
      }
    </script>

    
<meta name="generator" content="Hexo 5.4.0"></head>

<body>

<div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>

<script>setLoadingBarProgress(20)</script>

<div id="site-wrapper">

    <header id="header">
    <div id="header-wrapper" class="clearfix">
        <a id="logo" href="/">
            <img src="/img/logo.png"/>
            <span id="site-desc">
                otaku keeps alive
            </span>
        </a>
        <button id="site-nav-switch">
            <span class="icon icon-menu"></span>
        </button>
    </div>
</header>
    <script>setLoadingBarProgress(40);</script>

    <main id="main" role="main">
        
  <section class="page-header tag">
    <h1>- <span>sql</span> -</h1>
  </section>






<section class="post-list">
  
    
<article class="post ">

    
        <h2 class="title">
            <a href="/2021/03/26/SAP-HANA-PROCEDURE-sap-hana%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/">
                SAP HANA PROCEDURE(sap hanaæ•°æ®åº“ å­˜å‚¨è¿‡ç¨‹)
            </a>
        </h2>
    
    <time>
        3æœˆ 26, 2021
    </time>
    <section class="content">
        <h1><span id="å­˜å‚¨è¿‡ç¨‹">å­˜å‚¨è¿‡ç¨‹</span></h1><p>å†…å®¹å¼•è‡ª<a target="_blank" rel="noopener" href="https://www.cnblogs.com/jiangzhengjun/p/5040531.html#_Toc473120244">HANA SQLScript</a>ç¬¬ä¸‰éƒ¨åˆ†å‚¨å­˜è¿‡ç¨‹-åˆ›å»ºå‚¨å­˜è¿‡ç¨‹<del>æ˜¯çœŸé•¿</del></p>
<h2><span id="31create-procedure">3.1CREATE PROCEDURE</span></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> [<span class="operator">&lt;</span>schema_name<span class="operator">&gt;</span>.]<span class="operator">&lt;</span>proc_name<span class="operator">&gt;</span> [(<span class="operator">&lt;</span>parameter_clause<span class="operator">&gt;</span>)] [<span class="keyword">LANGUAGE</span> <span class="operator">&lt;</span>lang<span class="operator">&gt;</span>] [<span class="keyword">SQL</span> SECURITY <span class="operator">&lt;</span>mode<span class="operator">&gt;</span>]</span><br><span class="line">[<span class="keyword">DEFAULT</span> SCHEMA <span class="operator">&lt;</span>default_schema_name<span class="operator">&gt;</span>][<span class="keyword">READS</span> <span class="keyword">SQL</span> DATA [<span class="keyword">WITH</span> <span class="keyword">RESULT</span> <span class="keyword">VIEW</span> ]] <span class="keyword">AS</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span> [SEQUENTIAL EXECUTION]</span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span>procedure_body<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>The CREATE PROCEDURE statement creates a procedure using the specified programming language <lang>.</lang></p>
<p>DeepLç¿»è¯‘ï¼šCREATE PROCEDUREè¯­å¥ä½¿ç”¨æŒ‡å®šçš„ç¼–ç¨‹è¯­è¨€<lang>åˆ›å»ºä¸€ä¸ªè¿‡ç¨‹ã€‚</lang></p>
<h3><span id="311">3.1.1   <parameter_clause></parameter_clause></span></h3><ol>
<li><parameter_clause> ::= <parameter> [{,<parameter>}â€¦]<ol>
<li><parameter> ::= [<param_inout>] <param_name> <param_type><ol>
<li><param_inout> ::= IN|OUT|INOUT    </param_inout></li>
<li><param_type> ::= <sql_type> | <table_type> | <table_type_definition>              <ol>
<li><sql_type> ::= DATE | TIME| TIMESTAMP | SECONDDATE | TINYINT | SMALLINT |INTEGER | BIGINT | DECIMAL | SMALLDECIMAL | REAL | DOUBLE<br>| VARCHAR | NVARCHAR | ALPHANUM | VARBINARY | CLOB | NCLOB | BLOB</sql_type></li>
<li><table_type_defintion> ::= TABLE (<column_list_definition>)  <ol>
<li><column_list_definition> ::= <column_elem>[{, <column_elem>}â€¦]<ol>
<li><column_elem> ::= <column_name> <data_type></data_type></column_name></column_elem></li>
</ol>
</column_elem></column_elem></column_list_definition></li>
</ol>
</column_list_definition></table_type_defintion></li>
</ol>
</table_type_definition></table_type></sql_type></param_type></li>
</ol>
</param_type></param_name></param_inout></parameter></li>
</ol>
</parameter></parameter></parameter_clause></li>
</ol>
<p>è¾“å…¥æˆ–è¾“å‡ºå‚æ•°ç±»å‹å¯ä»¥æ˜¯æ ‡å‡†çš„åŸºç¡€æ•°æ®ç±»å‹ä¸è¡¨ç±»å‹ï¼Œä½†INOUTå‚æ•°åªèƒ½æ˜¯æ ‡å‡†æ•°æ®ç±»å‹</p>
<p><param_inout>ï¼šé»˜è®¤ä¸ºIN</param_inout></p>
<p><table_type_defintion>ï¼šå‚æ•°ç±»å‹å¦‚æœæ˜¯è¡¨ç±»å‹ï¼Œè¿™ä¸ªè¡¨ç±»å‹å¯ä»¥æ˜¯é¢„å…ˆä½¿ç”¨Create Typeâ€¦As Tableè¯­å¥åˆ›å»ºçš„ç±»å‹å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥åœ¨æŒ‡å®šå­˜å‚¨è¿‡ç¨‹å‚æ•°ç±»å‹æ—¶æ‰å®šä¹‰è¡¨ç±»å‹</table_type_defintion></p>
<h3><span id="312-language">3.1.2   LANGUAGE <lang></lang></span></h3><p><lang> ::= SQLSCRIPT | R</lang></p>
<p>é»˜è®¤ä¸º: SQLSCRIPTã€‚æŒ‡å®šå­˜å‚¨è¿‡ç¨‹å®ç°çš„ç¨‹åºè¯­è¨€</p>
<h3><span id="313-sql-security">3.1.3   SQL SECURITY <mode></mode></span></h3><p><mode> ::= DEFINER | INVOKER</mode></p>
<p>é»˜è®¤: DEFINERï¼ŒæŒ‡å®šå­˜å‚¨è¿‡ç¨‹çš„å®‰å…¨æ¨¡å¼</p>
<p>DEFINERï¼šSpecifies that the execution of the procedure is performed with the privileges of the definer of the procedure. </p>
<p>DEFINERï¼šåªæœ‰å­˜å‚¨è¿‡ç¨‹çš„å®šä¹‰è€…æ‰èƒ½æ‰§è¡Œï¼Ÿ</p>
<p>INVOKERï¼šSpecifies that the execution of the procedure is performed with the privileges of the invoker of the procedure.</p>
<h3><span id="314-reads-sql-data">3.1.4   READS SQL DATA</span></h3><p>å­˜å‚¨è¿‡ç¨‹ä¸ºåªè¯»çš„ï¼Œä¸èƒ½åŒ…å«DDLä¸DMLï¼ˆINSERTã€UPDATEã€DELETEï¼‰è¯­å¥ï¼ˆå³åªèƒ½ä½¿ç”¨æŸ¥è¯¢SQLä¸DCLè¯­å¥ï¼‰ï¼Œå¦‚æœè°ƒç”¨å…¶ä»–å­˜å‚¨è¿‡ç¨‹ï¼Œåˆ™è¢«è°ƒç”¨è¿‡ç¨‹ä¹Ÿæ˜¯åªè¯»çš„ã€‚è®¾ç½®å‚æ•°ä¼šæœ‰ç‰¹å®šçš„ä¼˜åŒ–</p>
<h3><span id="315-with-result-view">3.1.5   WITH RESULT VIEW <view_name></view_name></span></h3><p>Specifies the result view to be used as the output of a read-only procedure.å°†åªè¯»å–å­˜å‚¨è¿‡ç¨‹çš„è¾“å‡ºçœ‹åšç»“æœè§†å›¾</p>
<p>When a result view is defined for a procedure, it can be called by an SQL statement in the same way as a tableor view. See Example 2 - Using a result view below.å®šä¹‰äº†ç»“æœè§†å›¾çš„å­˜å‚¨è¿‡ç¨‹ï¼Œå¯ä»¥è¢«å…¶ä»–æŸ¥è¯¢SQLç”¨æ¥æŸ¥è¯¢ï¼Œæ­¤æ—¶å­˜å‚¨è¿‡ç¨‹å°±åƒä¸€ä¸ªè¡¨æˆ–è§†å›¾</p>
<h3><span id="316-sequential-execution">3.1.6   SEQUENTIAL EXECUTION</span></h3><p>This statement will force sequential execution of the procedure logic. No parallelism takes place.ä¸å…è®¸å­˜å‚¨è¿‡ç¨‹å¹¶è¡Œæ‰§è¡Œ</p>
<h3><span id="317">3.1.7   <procedure_body></procedure_body></span></h3><p><procedure_body> ::= [<proc_decl_list>]              å®šä¹‰å—<br>[<proc_handler_list>]            å¼‚å¸¸å¤„ç†å—<br><proc_stmt_list>                 å­˜å‚¨ä½“è¯­å¥å—</proc_stmt_list></proc_handler_list></proc_decl_list></procedure_body></p>
<p>Defines the main body of the procedure according to the programming language selected.è¿‡ç¨‹çš„ä¸»ä½“ç”±è®¾å®šçš„ç¨‹åºè¯­è¨€æ¥å®šä¹‰</p>
<h4><span id="3171-å®šä¹‰å˜é‡">3.1.7.1    <proc_decl_list> å®šä¹‰å˜é‡</proc_decl_list></span></h4><ol>
<li><proc_decl_list> ::= <proc_decl> [{<proc_decl>}â€¦]<ol>
<li><proc_decl> ::= <strong>DECLARE</strong> {<proc_variable>|<proc_table_variable>|<proc_cursor>|<proc_condition>} ;<ol>
<li><code>&lt;proc_variable&gt;::= &lt;variable_name_list&gt; [**CONSTANT**] &#123;&lt;sql_type&gt;|&lt;array_datatype&gt;&#125;[NOT NULL][&lt;proc_default&gt;]</code><ol>
<li><variable_name_list> ::= <variable_name>[{, &lt;variable_name}â€¦]</variable_name></variable_name_list></li>
<li><array_datatype> ::= <sql_type> ARRAY [ = <array_constructor> ]<ol>
<li><array_constructor> ::= ARRAY (<expression> [ { , <expression> }â€¦] )</expression></expression></array_constructor></li>
</ol>
</array_constructor></sql_type></array_datatype></li>
<li><proc_default> ::= (DEFAULT | â€˜=â€™ ) <value>|<expression></expression></value></proc_default></li>
</ol>
</li>
<li><proc_table_variable> ::= <variable_name_list> {<table_type_definition>|<table_type>}<ol>
<li><variable_name_list> ::= <variable_name>[{, &lt;variable_name}â€¦]</variable_name></variable_name_list></li>
<li><table_type_definition> ::= TABLE(<column_list_elements>)<ol>
<li><column_list_elements> ::= (<column_definition>[{,<column_definition>}â€¦])</column_definition></column_definition></column_list_elements></li>
</ol>
</column_list_elements></table_type_definition></li>
</ol>
</table_type></table_type_definition></variable_name_list></proc_table_variable></li>
<li><proc_cursor> ::= <strong>CURSOR</strong> <cursor_name> [ ( proc_cursor_param_list ) ] <strong>FOR</strong> <subquery> ;<ol>
<li><proc_cursor_param_list> ::= <proc_cursor_param> [{,<proc_cursor_param>}â€¦]<ol>
<li><proc_cursor_param> ::= <param_name> <datatype></datatype></param_name></proc_cursor_param></li>
</ol>
</proc_cursor_param></proc_cursor_param></proc_cursor_param_list></li>
</ol>
</subquery></cursor_name></proc_cursor></li>
<li><proc_condition> ::= <variable_name> CONDITION | <variable_name> CONDITION FOR <sql_error_code></sql_error_code></variable_name></variable_name></proc_condition></li>
</ol>
</proc_condition></proc_cursor></proc_table_variable></proc_variable></proc_decl></li>
</ol>
</proc_decl></proc_decl></proc_decl_list></li>
</ol>
<p><strong>CREATE</strong> <strong>procedure</strong> proc() <strong>LANGUAGE</strong> SQLSCRIPT <strong>AS</strong></p>
<p><strong>BEGIN</strong></p>
<p>â€‹    <strong>declare</strong> a <strong>int****default</strong> 2;â€“åŸºæœ¬ç±»å‹å˜é‡ä½¿ç”¨å‰ä¸€å®šè¦å®šä¹‰</p>
<p>â€‹    â€“ å¦‚æœæŸä¸ªå˜é‡æ˜¯è¡¨ç±»å‹çš„å˜é‡ï¼Œå¯ä»¥ä¸ç”¨å£°æ˜ï¼Œç›´æ¥å°±å¯ä»¥ä½¿ç”¨ï¼Œè¿™ä¸åŸºæœ¬ç±»å‹å˜é‡æ˜¯ä¸ä¸€æ ·çš„</p>
<p>â€‹    â€“ â€”â€”åŸºæœ¬ç±»å‹å˜é‡ä½¿ç”¨å‰éœ€è¦å®šä¹‰</p>
<p>â€‹    â€“declare tab_var1 table(a int,b int); è¡¨ç±»å‹å˜é‡å¯ä¸å®šä¹‰å°±ä½¿ç”¨</p>
<p>â€‹    a := 1;</p>
<p>â€‹    â€“ a = 1; åŸºæœ¬ç±»å‹å˜é‡èµ‹å€¼æ—¶ï¼Œç­‰å·å‰ä¸€å®šè¦åŠ å†’å·ï¼Œè¿™ä¸è¡¨ç±»å‹å˜é‡æ°å¥½ç›¸å</p>
<p>â€‹    tab_var1 = <strong>select</strong> 1 <strong>as</strong> a,2 <strong>as</strong> b <strong>from</strong> dummy;</p>
<p>â€‹    â€“tab_var1 := select 1 as a,2 as b from dummy; è¿™æ˜¯é”™è¯¯ï¼Œè¡¨ç±»å‹å˜é‡èµ‹å€¼æ—¶ï¼Œåªèƒ½ä½¿ç”¨ç­‰å·ï¼Œä¸èƒ½åœ¨ç­‰å·å‰åŠ å†’å·ï¼Œè¿™ä¸åŸºæœ¬ç±»å‹å˜é‡èµ‹å€¼ç›¸å</p>
<p><strong>END</strong>;</p>
<h1><span id="æš‚æ—¶çœ‹åˆ°è¿™äº†å¤ªé•¿äº†ä¸‹æ¬¡å†æ¥ç€çœ‹"><strong>æš‚æ—¶çœ‹åˆ°è¿™äº†ï¼šå¤ªé•¿äº†ä¸‹æ¬¡å†æ¥ç€çœ‹</strong></span></h1><h4><span id="3172-å¼‚å¸¸å¤„ç†">3.1.7.2    <proc_handler_list> å¼‚å¸¸å¤„ç†</proc_handler_list></span></h4><p><proc_handler_list> ::= <proc_handler> [{, <proc_handler>}â€¦]                </proc_handler></proc_handler></proc_handler_list></p>
<p><proc_handler>::= <a target="_blank" rel="noopener" href="https://www.cnblogs.com/jiangzhengjun/p/5040531.html#_DECLARE_EXIT_HANDLER">DECLARE EXIT HANDLER FOR</a> <proc_condition_value_list> <proc_stmt> ;</proc_stmt></proc_condition_value_list></proc_handler></p>
<p><proc_condition_value_list> ::= <proc_condition_value>{,<proc_condition_value>}â€¦]</proc_condition_value></proc_condition_value></proc_condition_value_list></p>
<p>â€‹                        <proc_condition_value> ::= <a target="_blank" rel="noopener" href="https://www.cnblogs.com/jiangzhengjun/p/5040531.html#_Autonomous_Transaction">SQLEXCEPTION </a>| SQLWARNING | <sql_error_code> | <condition_name></condition_name></sql_error_code></proc_condition_value></p>
<h4><span id="3173-è¿‡ç¨‹ä½“">3.1.7.3    <proc_stmt_list> è¿‡ç¨‹ä½“</proc_stmt_list></span></h4><p><proc_stmt_list> ::= {<proc_stmt>}â€¦</proc_stmt></proc_stmt_list></p>
<p><proc_stmt> ::= <proc_block>| <proc_assign>| <proc_single_assign>| <proc_multi_assign>| <proc_if>| <proc_loop>| <proc_while>| <proc_for>|<br><proc_foreach>| <proc_exit>| <proc_continue>| <proc_signal>| <proc_resignal>| <proc_sql>| <proc_open>| <proc_fetch>| <proc_close>| <proc_call>| <proc_exec>| <proc_return></proc_return></proc_exec></proc_call></proc_close></proc_fetch></proc_open></proc_sql></proc_resignal></proc_signal></proc_continue></proc_exit></proc_foreach></proc_for></proc_while></proc_loop></proc_if></proc_multi_assign></proc_single_assign></proc_assign></proc_block></proc_stmt></p>
<h5><span id="31731-å†…åµŒå—">3.1.7.3.1   <proc_block> å†…åµŒå—</proc_block></span></h5><p><proc_block> ::= BEGIN <proc_block_option>[<proc_decl_list>][<proc_handler_list>] <proc_stmt_list> END ;</proc_stmt_list></proc_handler_list></proc_decl_list></proc_block_option></proc_block></p>
<p><proc_block_option> ::= [SEQUENTIAL EXECUTION] [AUTONOMOUS TRANSACTION]| [AUTONOMOUS TRANSACTION] [SEQUENTIAL<br>                                 EXECUTION]</proc_block_option></p>
<p>å†…åµŒå—ï¼Œ BEGIN ã€ ENDæ˜¯å¯ä»¥å†…åµŒçš„</p>
<h5><span id="31732-ç»™å˜é‡èµ‹å€¼">3.1.7.3.2   <proc_assign> ç»™å˜é‡èµ‹å€¼</proc_assign></span></h5><p><proc_assign> ::= <variable_name> = { <expression> | <array_function> } ;| <variable_name> â€˜[â€˜ <expression> â€˜]â€™ = <expression> ;</expression></expression></variable_name></array_function></expression></variable_name></proc_assign></p>
<p><array_function> = ARRAY_AGG ( <table_variable>.<column_name> [ ORDER BY <sort_spec_list> ] ) | CARDINALITY ( <array_variable_name>) | TRIM_ARRAY<br>( <array_variable_name> , <array_variable_name>) | ARRAY ( <array_variable_name_list> )</array_variable_name_list></array_variable_name></array_variable_name></array_variable_name></sort_spec_list></column_name></table_variable></array_function></p>
<p>â€‹                                        <array_variable_name_list> ::=&lt; array_variable_name &gt; [{, &lt; array_variable_name &gt;}â€¦]  è¿™ä¸ªæ˜¯è‡ªå·± åŠ çš„ï¼Œæ˜¯å¦æ­£ç¡®ï¼Ÿ</array_variable_name_list></p>
<p>Assign values to variables. An <expression> can be either a simple expression, such as a character, a date, or a number, or it can be a scalar function or a scalar user-defined function.å°†å€¼èµ‹ç»™å˜é‡ã€‚<expression>å¯ä»¥æ˜¯ä¸€ä¸ªç®€å•çš„è¡¨è¾¾å¼ï¼ˆå¦‚å­—ç¬¦ã€æ—¥æœŸã€æ•°å­—è¡¨è¾¾å¼ï¼‰ï¼Œæˆ–è€…æ˜¯æ ‡å‡†å‡½æ•°ï¼Œæˆ–ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°</expression></expression></p>
<p>æœ‰å…³ ARRAY ã€ARRAY_AGGã€CARDINALITYã€TRIM_ARRAYå‡½æ•°è¯·å‚è€ƒåé¢æ•°ç»„å‡½æ•°</p>
<h5><span id="31733-å•ä¸ªèµ‹å€¼">3.1.7.3.3   <proc_single_assign> å•ä¸ªèµ‹å€¼</proc_single_assign></span></h5><p><proc_single_assign> ::= <variable_name> = <subquery> | <variable_name> = <proc_ce_call> | <variable_name> = <proc_apply_filter>| <variable_name> =<br><unnest_function></unnest_function></variable_name></proc_apply_filter></variable_name></proc_ce_call></variable_name></subquery></variable_name></proc_single_assign></p>
<p><proc_ce_call> ::= TRACE ( <variable_name> ) ;| CE_LEFT_OUTER_JOIN ( <table_variable> , <table_variable> ,â€™[â€˜ <expr_alias_comma_list> â€˜]â€™ <expr_alias_vector>] ) ;<br> | CE_RIGHT_OUTER_JOIN ( <table_variable> , <table_variable> ,â€™[â€˜ <expr_alias_comma_list> â€˜]â€™ [ <expr_alias_vector>] ) ; | CE_FULL_OUTER_JOIN ( <table_variable> , <table_variable> ,â€™[â€˜ <expr_alias_comma_list> â€˜]â€™ [ <expr_alias_vector>] ); | CE_JOIN ( <table_variable> , <table_variable> , â€˜[â€˜<expr_alias_comma_list> â€˜]â€™ [<expr_alias_vector>] ) ;| CE_UNION_ALL ( <table_variable> , <table_variable> ) ;| CE_COLUMN_TABLE ( <table_name> [ <expr_alias_vector>] ) ; | CE_JOIN_VIEW ( <table_name> [ <expr_alias_vector>] ) ;| CE_CALC_VIEW ( <table_name> [ <expr_alias_vector>] ) ; | CE_OLAP_VIEW ( <table_name> [ <expr_alias_vector>] ) ; | CE_PROJECTION ( <table_variable> , â€˜[â€˜<expr_alias_comma_list> â€˜]â€™ <opt_str_const> ) ; | CE_PROJECTION ( <table_variable> <opt_str_const> ) ; | CE_AGGREGATION ( <table_variable> , â€˜[â€˜<agg_alias_comma_list> â€˜]â€™ [ <expr_alias_vector>] ); | CE_CONVERSION ( <table_variable> , â€˜[â€˜<proc_key_value_pair_comma_list> â€˜]â€™ [ <expr_alias_vector>] ) ;| CE_VERTICAL_UNION ( <table_variable> , â€˜[â€˜<expr_alias_comma_list> â€˜]â€™ <vertical_union_param_pair_list> ) ;| CE_COMM2R ( <table_variable> , <int_const> , <str_const> ,<int_const> , <int_const> , <str_const> ) ;</str_const></int_const></int_const></str_const></int_const></table_variable></vertical_union_param_pair_list></expr_alias_comma_list></table_variable></expr_alias_vector></proc_key_value_pair_comma_list></table_variable></expr_alias_vector></agg_alias_comma_list></table_variable></opt_str_const></table_variable></opt_str_const></expr_alias_comma_list></table_variable></expr_alias_vector></table_name></expr_alias_vector></table_name></expr_alias_vector></table_name></expr_alias_vector></table_name></table_variable></table_variable></expr_alias_vector></expr_alias_comma_list></table_variable></table_variable></expr_alias_vector></expr_alias_comma_list></table_variable></table_variable></expr_alias_vector></expr_alias_comma_list></table_variable></table_variable></expr_alias_vector></expr_alias_comma_list></table_variable></table_variable></variable_name></proc_ce_call></p>
<p><table_name> ::= [<schema_name>.]<identifier></identifier></schema_name></table_name></p>
<p><proc_apply_filter> ::= APPLY_FILTER ( {<table_name> | <table_variable>},<variable_name> ) ;</variable_name></table_variable></table_name></proc_apply_filter></p>
<p><unnest_function> ::= UNNEST ( <variable_name_list> ) [ WITH ORDINALITY ][<as_col_names>] ;</as_col_names></variable_name_list></unnest_function></p>
<p><variable_name_list> ::= <variable_name> [{, <variable_name>}â€¦]</variable_name></variable_name></variable_name_list></p>
<p><as_col_names> ::= AS [table_name] ( <column_name_list> )</column_name_list></as_col_names></p>
<p><column_name_list> ::= <column_name>[{, <column_name>}â€¦]</column_name></column_name></column_name_list></p>
<p>WITH ORDINALTIYï¼šAppends an ordinal column to the return values.</p>
<h5><span id="31734-å¤šä¸ªèµ‹å€¼">3.1.7.3.4   <proc_multi_assign> å¤šä¸ªèµ‹å€¼</proc_multi_assign></span></h5><p><proc_multi_assign> ::= (<var_name_list>) = <function_expression></function_expression></var_name_list></proc_multi_assign></p>
<p>Assign values to a list of variables with only one function evaluation. For example, <function_expression>must be a scalar user defined function and the number of elements in <var_name_list> must be equal to the number of output parameters of the scalar UDFï¼ˆç”¨æˆ·å®šä¹‰å‡½æ•°ï¼‰.</var_name_list></function_expression></p>
<p><function_expression>ï¼šç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°</function_expression></p>
<p>å‡½æ•°çš„è¾“å…¥å‚æ•°ä¸ªæ•°éœ€ä¸<var_name_list>ä¸­çš„å‚æ•°ä¸ªæ•°ç›¸åŒ</var_name_list></p>
<h5><span id="31735">3.1.7.3.5   <proc_if></proc_if></span></h5><p><proc_if> ::= <strong>IF</strong> <condition> <strong>THEN</strong> [SEQUENTIAL EXECUTION][<proc_decl_list>] [<proc_handler_list>] <proc_stmt_list> [<proc_elsif_list>] [<proc_else>] <strong>END IF</strong> ;</proc_else></proc_elsif_list></proc_stmt_list></proc_handler_list></proc_decl_list></condition></proc_if></p>
<p><proc_elsif_list> ::= <strong>ELSEIF</strong> <condition> <strong>THEN</strong> [SEQUENTIAL EXECUTION][<proc_decl_list>] [<proc_handler_list>] <proc_stmt_list></proc_stmt_list></proc_handler_list></proc_decl_list></condition></proc_elsif_list></p>
<p><proc_else> ::= <strong>ELSE</strong> [SEQUENTIAL EXECUTION][<proc_decl_list>][<proc_handler_list>] <proc_stmt_list></proc_stmt_list></proc_handler_list></proc_decl_list></proc_else></p>
<p>You use IF - THEN - ELSE IF to control execution flow with conditionals.</p>
<h5><span id="31736">3.1.7.3.6   <proc_loop></proc_loop></span></h5><p><proc_loop> ::= <strong>LOOP</strong> [SEQUENTIAL EXECUTION][<proc_decl_list>] [<proc_handler_list>] <proc_stmt_list> <strong>END LOOP</strong> ;</proc_stmt_list></proc_handler_list></proc_decl_list></proc_loop></p>
<p>You use loop to repeatedly execute a set of statements.</p>
<h5><span id="31737">3.1.7.3.7   <proc_while></proc_while></span></h5><p><proc_while> ::= <strong>WHILE</strong> <condition> <strong>DO</strong> [SEQUENTIAL EXECUTION][<proc_decl_list>] [<proc_handler_list>] <proc_stmt_list> <strong>END WHILE</strong> ;</proc_stmt_list></proc_handler_list></proc_decl_list></condition></proc_while></p>
<p>You use while to repeatedly call a set of trigger statements while a condition is true.</p>
<h5><span id="31738">3.1.7.3.8   <proc_for></proc_for></span></h5><p><proc_for> ::= <strong>FOR</strong> <column_name> <strong>IN</strong> [ REVERSE ] <expression> [â€¦] <expression> <strong>DO</strong> [SEQUENTIAL EXECUTION]</expression></expression></column_name></proc_for></p>
<p>[<proc_decl_list>]</proc_decl_list></p>
<p> [<proc_handler_list>]</proc_handler_list></p>
<proc_stmt_list>

<p><strong>END FOR</strong> ;</p>
<p>You use FOR - IN loops to iterate over a set of data.</p>
<h5><span id="31739">3.1.7.3.9   <proc_foreach></proc_foreach></span></h5><p><proc_foreach> ::= <strong>FOR</strong> <column_name> <strong>AS</strong> <column_name> [<open_param_list>] <strong>DO</strong> [SEQUENTIAL EXECUTION]</open_param_list></column_name></column_name></proc_foreach></p>
<p>[<proc_decl_list>]</proc_decl_list></p>
<p>[<proc_handler_list>]</proc_handler_list></p>
<proc_stmt_list>

<p>END <strong>FOR</strong> ;</p>
<p><open_param_list> ::= ( <expression> [ { , <expression> }â€¦] )</expression></expression></open_param_list></p>
<p>You use FOR - EACH loops to iterate over all elements in a set of data.</p>
<h5><span id="317310">3.1.7.3.10   <proc_exit></proc_exit></span></h5><p><proc_exit> ::= BREAK ;</proc_exit></p>
<p>Terminates a loop.ç»“æŸå¾ªç¯</p>
<h5><span id="317311">3.1.7.3.11   <proc_continue></proc_continue></span></h5><p><proc_continue> ::= CONTINUE ;</proc_continue></p>
<p>Skips a current loop iteration and continues with the next value.ç»“æŸå½“å‰å¾ªç¯ç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯</p>
<h5><span id="317312">3.1.7.3.12   <proc_signal></proc_signal></span></h5><p><proc_signal> ::= SIGNAL <signal_value> [<set_signal_info>] ;</set_signal_info></signal_value></proc_signal></p>
<p>You use the SIGNAL statement to explicitly raise an exception from within your trigger procedures.</p>
<h5><span id="317313">3.1.7.3.13   <proc_resignal></proc_resignal></span></h5><p><proc_resignal> ::= RESIGNAL [<signal_value>] [<set_signal_info>] ;</set_signal_info></signal_value></proc_resignal></p>
<p>You use the RESIGNAL statement to raise an exception on the action statement in an exception handler. If an error code is not specified, RESIGNAL will throw the caught exception.é‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼Ÿ</p>
<p><signal_value> ::= <signal_name> | <sql_error_code></sql_error_code></signal_name></signal_value></p>
<p><signal_name> ::= <identifier></identifier></signal_name></p>
<p><sql_error_code> ::= <unsigned_integer></unsigned_integer></sql_error_code></p>
<p>You can SIGNAL or RESIGNAL a signal name or an SQL error code.</p>
<p><set_signal_info> ::= SET MESSAGE_TEXT = â€˜<message_string>â€˜</message_string></set_signal_info></p>
<p><message_string> ::= <any_character></any_character></message_string></p>
<p>You use SET MESSAGE_TEXT to deliver an error message to users when specified error is thrown during procedure execution.</p>
<h5><span id="317314">3.1.7.3.14   <proc_sql></proc_sql></span></h5><p><proc_sql> ::= <subquery> | <select_into_stmt> | <insert_stmt> | <delete_stmt> | <update_stmt> | <replace_stmt> | <call_stmt> | <create_table> | <drop_table></drop_table></create_table></call_stmt></replace_stmt></update_stmt></delete_stmt></insert_stmt></select_into_stmt></subquery></proc_sql></p>
<p><insert_stmt>, <delete_stmt>,<update_stmt>,<replace_stmt> and <upsert_stmt>è¯·å‚è€ƒHANA SQLä¸­INSERT , DELETE, UPDATE, REPLACE and UPSERT SQLè¯­å¥</upsert_stmt></replace_stmt></update_stmt></delete_stmt></insert_stmt></p>
<p><select_into_stmt> ::= SELECT <select_list> INTO <var_name_list> <from_clause> [<where_clause>] [<group_by_clause>] [<having_clause>] [{<set_operator><br><subquery>, â€¦ }] [<order_by_clause>] [<limit>] ;</limit></order_by_clause></subquery></set_operator></having_clause></group_by_clause></where_clause></from_clause></var_name_list></select_list></select_into_stmt></p>
<p><var_name_list> ::= <var_name>[{, <var_name>}â€¦]   <var_name>ä¸ºåŸºç¡€ç±»å‹å˜é‡</var_name></var_name></var_name></var_name_list></p>
<h5><span id="317315">3.1.7.3.15   <proc_open>ã€<proc_fetch>ã€<proc_close></proc_close></proc_fetch></proc_open></span></h5><p><proc_open> ::= OPEN <cursor_name> [ <open_param_list>] ;</open_param_list></cursor_name></proc_open></p>
<p><proc_fetch> ::= FETCH <cursor_name> INTO <column_name_list> ;</column_name_list></cursor_name></proc_fetch></p>
<p><proc_close> ::= CLOSE <cursor_name> ;</cursor_name></proc_close></p>
<p>Cursor operations</p>
<h5><span id="317316">3.1.7.3.16   <proc_call></proc_call></span></h5><p><proc_call> ::= CALL <proc_name> (<param_list>) ;</param_list></proc_name></proc_call></p>
<p>Calling a procedure</p>
<h5><span id="317317">3.1.7.3.17   <proc_exec></proc_exec></span></h5><p><proc_exec> ::= {EXEC | EXECUTE IMMEDIATE} <proc_expr> ;</proc_expr></proc_exec></p>
<p>You use EXEC to make dynamic SQL calls.</p>
<h5><span id="317318">3.1.7.3.18   <proc_return></proc_return></span></h5><p><proc_return> ::= RETURN [<proc_expr>] ;</proc_expr></proc_return></p>
<p>Return a value from a procedure.</p>
<h3><span id="318-examples">3.1.8   Examples</span></h3><p>Example 1 - Creating an SQL Procedure</p>
<p>You create an SQLScript procedure with the following definition.</p>
<p><strong>CREATE<strong><strong>COLUMN</strong></strong>TABLE</strong>â€œSYSTEMâ€.â€Tâ€ (â€œIDâ€<strong>INTEGER</strong> CS_INT,</p>
<p>â€‹     â€œNAMEâ€<strong>VARCHAR</strong>(30),</p>
<p>â€‹     â€œPAYMENTâ€<strong>INTEGER</strong> CS_INT) <strong>UNLOAD****PRIORITY</strong> 5 AUTO <strong>MERGE</strong>;</p>
<p><strong>insert****into</strong>â€œSYSTEMâ€.â€Tâ€<strong>values</strong>(1,â€™aâ€™,10);</p>
<p><strong>insert****into</strong>â€œSYSTEMâ€.â€Tâ€<strong>values</strong>(2,â€™bâ€™,20);</p>
<p><strong>insert****into</strong>â€œSYSTEMâ€.â€Tâ€<strong>values</strong>(3,â€™câ€™,30);</p>
<p><strong>CREATE****PROCEDURE</strong> orchestrationProc <strong>LANGUAGE</strong> SQLSCRIPT <strong>AS</strong></p>
<p><strong>BEGIN</strong></p>
<p>â€‹    <strong>DECLARE</strong> v_id <strong>INT</strong>;</p>
<p>â€‹    <strong>DECLARE</strong> v_name <strong>VARCHAR</strong>(30);</p>
<p>â€‹    <strong>DECLARE</strong> v_pmnt <strong>INT</strong>;</p>
<p>â€‹    <strong>DECLARE</strong> v_msg <strong>VARCHAR</strong>(200);</p>
<p>â€‹    <strong>DECLARE****CURSOR</strong> c_cursor1 (p_payment <strong>INT</strong>) <strong>FOR****SELECT</strong> id, name, PAYMENT <strong>FROM</strong> t</p>
<p>â€‹           <strong>WHERE</strong> payment &gt;= p_payment <strong>ORDER****BY</strong> id <strong>ASC</strong>;</p>
<p>â€‹    <strong>OPEN</strong> c_cursor1(20);</p>
<p>â€‹    <strong>FETCH</strong> c_cursor1 <strong>INTO</strong> v_id, v_name, v_pmnt;</p>
<p>â€‹    v_msg := v_name || â€˜ (id â€˜ || v_id || â€˜) earns â€˜ || v_pmnt || â€˜ $.â€™;</p>
<p>â€‹    <strong>select</strong> v_msg <strong>from</strong> dummy;</p>
<p>â€‹    <strong>CLOSE</strong> c_cursor1;</p>
<p><strong>end</strong>;</p>
<p>Example 2 - Using a result view</p>
<p>åˆ›å»ºå¸¦è¿”å›è§†å›¾ç»“æœçš„å­˜å‚¨è¿‡ç¨‹ï¼š</p>
<p><strong>CREATE****PROCEDURE</strong> ProcWithResultView(<strong>IN</strong> id <strong>INT</strong>, <strong>OUT</strong> o1 t)</p>
<p><strong>LANGUAGE</strong> SQLSCRIPT</p>
<p>READS <strong>SQL</strong> DATA <strong>WITH</strong> RESULT <strong>VIEW</strong> ProcView <strong>AS</strong></p>
<p><strong>BEGIN</strong></p>
<p>o1 = <strong>SELECT</strong> * <strong>FROM</strong> t <strong>WHERE</strong> id = :id;</p>
<p><strong>END</strong>;</p>
<p>è°ƒç”¨å­˜å‚¨è§†å›¾ï¼š</p>
<p><strong>select</strong> * <strong>from</strong> ProcView <strong>with</strong> parameters (â€˜placeholderâ€™ = (â€˜</p>
<p>idid</p>
<p>â€˜ ,â€™2â€™ ));</p>
<p><strong>CREATE****PROCEDURE</strong> Proc_test(<strong>IN</strong> id <strong>INT</strong>,<strong>IN</strong> name <strong>varchar</strong>(3),<strong>OUT</strong> o1 â€œSYSTEMâ€.â€T_COLUMNâ€)</p>
<p><strong>LANGUAGE</strong> SQLSCRIPT</p>
<p>READS <strong>SQL</strong> DATA <strong>WITH</strong> RESULT <strong>VIEW</strong> Proc_View <strong>AS</strong></p>
<p><strong>BEGIN</strong></p>
<p>outt = CE_COLUMN_TABLE(â€œSYSTEMâ€.â€T_COLUMNâ€,[id,name,payment]);</p>
<p>â€“æ³¨ï¼šè¿‡æ»¤æ¡ä»¶ä¸€å®šè¦ä½¿ç”¨å•å¼•å·æ•´ä½“å¼•èµ·æ¥ï¼›åˆ—åä¸€å®šè¦ä½¿ç”¨åŒå¼•å·å¼•èµ·æ¥ï¼›</p>
<p>â€“å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™è¦ä½¿ç”¨å•å¼•å·å¼•èµ·æ¥ï¼Œå› ä¸ºå¤–å±‚æœ‰å•å¼•å·ï¼Œæ‰€ä»¥é‡Œé¢è¦ä½¿ç”¨ä¸¤ä¸ªå•å¼•å·ä»£è¡¨ä¸€ä¸ªå•å¼•å·</p>
<p>â€“o1 = CE_PROJECTION(:outt,[id,name,payment],â€™â€IDâ€ = :id AND â€œNAMEâ€ = â€˜â€™:nameâ€™â€™â€™);</p>
<p>â€“ä¸Šé¢è¿™å¥ç­‰æ•ˆäºä¸‹é¢ä¸¤å¥</p>
<p>o1 = CE_PROJECTION(:outt,[id,name,payment],â€™â€IDâ€ = :idâ€™);</p>
<p>o1 = CE_PROJECTION(:o1,[id,name,payment],â€™â€NAMEâ€ = â€˜â€™:nameâ€™â€™â€™);</p>
<p><strong>END</strong>;</p>
<p><strong>select</strong> * <strong>from</strong> Proc_View <strong>with</strong> parameters (â€˜placeholderâ€™ = (â€˜</p>
<p>idid</p>
<p>â€˜ ,â€™2â€™ ),â€™placeholderâ€™ = (â€˜namenameâ€™ ,â€™bâ€™ ));</p>
<p>Note</p>
<p>Procedures and result views produced by procedures are not connected from the security perspective and therefore do not inherit privileges from each other. The security aspects of each object must be handled separately. For example, you must grant the SELECT privilege on a result view and EXECUTE privilege on a connected procedure.</p>
<img src="\img\7a1c08c79f3df8dccd0ae9edda11728b461028ed.gif" alt="7a1c08c79f3df8dccd0ae9edda11728b461028ed" style="zoom:100%;">



</proc_stmt_list></proc_stmt_list>

        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/sql/" rel="tag">sql</a><a class="tag-none-link" href="/tags/study/" rel="tag">study</a>
            </div>
        

    </section>
</article>

  
    
<article class="post ">

    
        <h2 class="title">
            <a href="/2021/03/24/Oracle%E4%B8%AD%E7%9A%84translate%E5%87%BD%E6%95%B0%E5%92%8Creplace%E5%87%BD%E6%95%B0%E7%9A%84%E7%94%A8%E6%B3%95/">
                Oracleä¸­çš„translateå‡½æ•°å’Œreplaceå‡½æ•°çš„ç”¨æ³•
            </a>
        </h2>
    
    <time>
        3æœˆ 24, 2021
    </time>
    <section class="content">
        <p>æ¥è§¦åˆ°æ­¤å‡½æ•°ç›®çš„æ˜¯ä¸ºäº†åˆ¤æ–­æŸä¸€å•å…ƒæ ¼æ•°æ®æ˜¯åœ¨è¿™é‡Œæ’å…¥ä»£ç ç‰‡å¦ä¸ºçº¯æ•°å­—ï¼Œè™½ç„¶å®é™…æ¥è¯´TRANSLATE()å®é™…ä¸æ˜¯ä¸ºäº†åˆ¤æ–­æ•°æ®æ ¼å¼ã€‚</p>
<p><strong>translateå‡½æ•°è¯­æ³•ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">translate</span>(expr, from_string, to_string)</span><br></pre></td></tr></table></figure>

<p>åŠŸèƒ½ï¼šåœ¨exprä¸­å¯»æ‰¾åŒ¹é…from_stringä¸­ç¬¦åˆçš„å­—ç¬¦ä¸‹æ ‡ï¼Œéšåæ ¹æ®ä¸‹æ ‡å»to_stringä¸­å¯»æ‰¾å¯¹åº”çš„å­—ç¬¦æ›¿æ¢æ‰exprä¸­å¯¹åº”ä¸‹æ ‡çš„å­—ç¬¦ã€‚</p>
<p>exprï¼šè¿›è¡Œå¤„ç†åŒ¹é…æ›¿æ¢çš„æ•°æ®</p>
<p>from_stringï¼šéœ€è¦åœ¨exprä¸­å¯»æ‰¾åŒ¹é…çš„å­—ç¬¦</p>
<p>to_stringï¼šæ›¿æ¢åœ¨from_stringä¸­æ‰¾åˆ°çš„exprä¸­å¯¹åº”ä¸‹æ ‡çš„å­—ç¬¦</p>
<p><strong>æ —å­ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">translate</span>(<span class="string">&#x27;ac&#x27;</span>,<span class="string">&#x27;ab2&#x27;</span>,<span class="string">&#x27;00&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--return 0c</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæ‹¿å‡ºacä¸­çš„aå»åŒ¹é…ab2ä¸­çš„å­—ç¬¦ï¼Œä»–ä¼šä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦çš„è¿›è¡Œåˆ¤æ–­ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a==a <span class="literal">true</span>      	<span class="comment">//aå’Œab2ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ¯”è¾ƒï¼Œç»“æœæ­£ç¡®</span></span><br><span class="line">a==b <span class="literal">false</span>      <span class="comment">//aå’Œab2ä¸­çš„ç¬¬äºŒä¸ªå­—ç¬¦æ¯”è¾ƒï¼Œç»“æœé”™è¯¯</span></span><br><span class="line">a==<span class="number">2</span> <span class="literal">false</span>      <span class="comment">//aå’Œab2ä¸­çš„ç¬¬ä¸‰ä¸ªå­—ç¬¦æ¯”è¾ƒï¼Œç»“æœé”™è¯¯</span></span><br></pre></td></tr></table></figure>

<p>è€Œå…¶ä¸­çš„aåŒ¹é…åˆ°äº†ab2ä¸­çš„å­—ç¬¦ï¼Œaåœ¨ab2ä¸­ä¸ºç¬¬ä¸€ä½ï¼Œæ‰€ä»¥ä¹Ÿå»00ä¸­å¯»æ‰¾ç¬¬ä¸€ä½è¿›è¡Œæ›¿æ¢ï¼Œè¿™æ—¶æ˜¯0cã€‚</p>
<p>å†å»åŒ¹é…ç¬¬äºŒä½çš„cï¼Œè€Œåœ¨ab2ä¸­æ²¡æœ‰æ‰¾åˆ°ï¼Œæ‰€ä»¥ä¸è¿›è¡Œæ›¿æ¢ã€‚</p>
<p>æ‰€ä»¥è¿”å›çš„ç»“æœä¸º0cã€‚</p>
<p><strong>æ —å­iiï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">translate</span>(<span class="string">&#x27;ac1&#x27;</span>,<span class="string">&#x27;abc123&#x27;</span>,<span class="string">&#x27;abc&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--return ac</span></span><br></pre></td></tr></table></figure>

<p>å½“to_stringæ¯”from_stringçŸ­æ—¶ï¼Œä¼šå¯¹å¤šä½™çš„ä½æ•°è¿›è¡Œå‰”é™¤</p>
<p>è¿™é‡Œä¸­è¿›è¡ŒåŒ¹é…åˆ°æœ€åçš„1æ—¶ï¼Œå‘ç°1åœ¨abc123ä¸­ä½ç½®ä¸ºç¬¬å››ä½ï¼Œè€Œé€šè¿‡ç¬¬å››ä½å»æ›¿æ¢ï¼Œå»å¯»æ‰¾abcçš„ç¬¬å››ä½æ—¶å‘ç°abcæ²¡æœ‰ç¬¬å››ä½ï¼Œè¿™æ—¶ä¼šå°†1å‰”é™¤ï¼Œè¿”å›çš„ç»“æœä¸ºacã€‚</p>
<p>  éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œto_strä¸èƒ½æ˜¯NULLæˆ–è€…â€™â€™ï¼Œå¦åˆ™ä¼šè¿”å›ç©ºå€¼ã€‚</p>
<ol>
<li>translateä¹Ÿä¸èƒ½ç”¨äºCLOBï¼Œå†è¯´å¾—ç®€å•ä¸€ç‚¹ï¼Œä¹Ÿå°±æ˜¯<br>å¦‚æœstringä¸­çš„å­—ç¬¦å¦‚æœåœ¨from_stringä¸­æ²¡æœ‰ï¼Œé‚£ä¹ˆè¿”å›æ—¶è¢«ä¿ç•™</li>
<li>å¦‚æœstringä¸­çš„å­—ç¬¦æ˜¯from_stringä¸­çš„â€é¢å¤–å­—ç¬¦â€ï¼Œé‚£ä¹ˆè¿”å›æ—¶è¢«åˆ é™¤</li>
<li>å¦‚æœstringä¸­çš„å­—ç¬¦åœ¨from_stringä¸­æ‰¾åˆ°ï¼Œä¸”åœ¨to_stringä¸­æœ‰ç›¸åº”ä½ç½®çš„å­—ç¬¦ï¼Œé‚£ä¹ˆè¿”å›æ—¶ç”¨to_stringä¸­çš„å­—ç¬¦æ›¿æ¢stringä¸­çš„å­—ç¬¦</li>
</ol>
<p><strong>replaceå‡½æ•°</strong></p>
<p><strong>è¯­æ³•ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REPLACE(expr, from_string,to_string)</span><br></pre></td></tr></table></figure>

<p>åŠŸèƒ½ï¼šç”¨æ³•å’Œä¸Šæ–‡ä¸­çš„translateçš„ç”¨æ³•ç›¸åŒï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯translateæ˜¯ä¼šå¯¹exprä¸­çš„å­—ç¬¦ä¸€ä¸ªä¸€ä¸ªå’Œfrom_stringè¿›è¡ŒåŒ¹é…ï¼Œè€Œreplaceå´ç±»ä¼¼äºæ¨¡ç³ŠæŸ¥è¯¢likeï¼Œä¼šåœ¨exprä¸­æŸ¥æ‰¾åŒ…å«from_stringçš„éƒ¨åˆ†å¹¶ä¸”è¿›è¡Œæ›¿æ¢ä¸ºto_stringã€‚</p>
<p>exprï¼šè¿›è¡Œå¤„ç†åŒ¹é…æ›¿æ¢çš„æ•°æ®</p>
<p>from_stringï¼šéœ€è¦åœ¨exprä¸­å¯»æ‰¾åŒ¹é…çš„å­—ç¬¦</p>
<p>to_stringï¼šæ›¿æ¢åœ¨from_stringä¸­æ‰¾åˆ°çš„exprä¸­å¯¹åº”ä¸‹æ ‡çš„å­—ç¬¦</p>
<p><strong>æ —å­ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> REPLACE(<span class="string">&#x27;fgsgswsgs&#x27;</span>, <span class="string">&#x27;fk&#x27;</span> ,<span class="string">&#x27;j&#x27;</span>) è¿”å›å€¼ <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--return  fgsgswsgs</span></span><br><span class="line"><span class="keyword">select</span> REPLACE(<span class="string">&#x27;fgsgswsgs&#x27;</span>, <span class="string">&#x27;sg&#x27;</span> ,<span class="string">&#x27;eeerrrttt&#x27;</span>) è¿”å›å€¼ <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--return  fgeeerrrtttsweeerrrttts</span></span><br></pre></td></tr></table></figure>

<p><strong>åˆ†æï¼š</strong></p>
<p>ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ç”±äºâ€™fgsgswsgsâ€™ä¸­æ²¡æœ‰ä¸â€™fkâ€™åŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œ</p>
<p>â€‹      æ•…è¿”å›å€¼ä»ç„¶æ˜¯â€™fgsgswsgsâ€™ï¼›</p>
<p>â€‹      ç¬¬äºŒä¸ªä¾‹å­ä¸­å°†â€™fgsgswsgsâ€™ä¸­çš„å­—ç¬¦ä¸²â€™sgâ€™å…¨éƒ¨è½¬æ¢ä¸ºâ€™eeerrrtttâ€™ã€‚</p>
<p>æ€»ç»“ï¼šç»¼ä¸Šæ‰€è¿°ï¼Œreplaceä¸translateéƒ½æ˜¯æ›¿ä»£å‡½æ•°ï¼Œ</p>
<p>â€‹     åªä¸è¿‡replaceé’ˆå¯¹çš„æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œtranslateé’ˆå¯¹çš„æ˜¯å•ä¸ªå­—ç¬¦ã€‚</p>
<p><strong>å’Œreplaceå‡½æ•°çš„åŒºåˆ«</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">translate</span>(<span class="string">&#x27;itmyhome#163%com&#x27;</span>, <span class="string">&#x27;#%&#x27;</span>, <span class="string">&#x27;@.&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--return itmyhome@163.com</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> replace(<span class="string">&#x27;itmyhome#163%com&#x27;</span>, <span class="string">&#x27;#%&#x27;</span>, <span class="string">&#x27;@.&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--return  itmyhome#163%com</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„translateå‡½æ•°æ˜¯å°†#æ›¿æ¢ä¸º@ï¼Œ%æ›¿æ¢ä¸º.</p>
<p>è€Œreplaceå´æ²¡æœ‰å®ç°æ­¤æ•ˆæœï¼Œæ˜¯å› ä¸ºæ²¡æœ‰æ‰¾åˆ°#%æ•´ä½“çš„ç»„åˆ</p>
<p>éƒ¨åˆ†å¼•è‡ª</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/u010104750/article/details/52388609">translateå‡½æ•°çš„ç”¨æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jb51.net/article/128565.htm">Oracleä¸­çš„translateå‡½æ•°å’Œreplaceå‡½æ•°çš„ç”¨æ³•è¯¦è§£</a></li>
</ul>
<img class="bigimg" src="\img\53186325_p0.jpg" alt="53186325_p0" style="zoom:100%;">

<p><em><strong>æˆ¦ã„ã®å‰å¤œ</strong></em></p>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/sql/" rel="tag">sql</a><a class="tag-none-link" href="/tags/study/" rel="tag">study</a>
            </div>
        

    </section>
</article>

  
    
<article class="post ">

    
        <h2 class="title">
            <a href="/2021/03/15/%E5%BC%80%E7%AA%97%E5%87%BD%E6%95%B0/">
                å¼€çª—å‡½æ•°
            </a>
        </h2>
    
    <time>
        3æœˆ 15, 2021
    </time>
    <section class="content">
        <h5><span id="æ’åºå‡½æ•°">æ’åºå‡½æ•°</span></h5><p>å¼€çª—å‡½æ•°over()ï¼ŒåŒ…å«ä¸‰ä¸ªåˆ†æå­å¥:åˆ†ç»„(partition by), æ’åº(order by), çª—å£(rows) ï¼Œä»–ä»¬çš„ä½¿ç”¨å½¢å¼å¦‚ä¸‹ï¼šover(partition by æ’åºå­—æ®µ order by åˆ†åŒºå­—æ®µ rows between å¼€çª—è§„åˆ™)ã€‚</p>
<p>å¼€çª—å‡½æ•°<br>   Oracleä»8.1.6å¼€å§‹æä¾›åˆ†æå‡½æ•°ï¼Œåˆ†æå‡½æ•°ç”¨äºè®¡ç®—åŸºäºç»„çš„æŸç§èšåˆå€¼ï¼Œå®ƒå’Œèšåˆå‡½æ•°çš„ä¸åŒä¹‹å¤„æ˜¯ï¼šå¯¹äºæ¯ä¸ªç»„è¿”å›å¤šè¡Œï¼Œè€Œèšåˆå‡½æ•°å¯¹äºæ¯ä¸ªç»„åªè¿”å›ä¸€è¡Œã€‚</p>
<p>   å¼€çª—å‡½æ•°æŒ‡å®šäº†åˆ†æå‡½æ•°å·¥ä½œçš„æ•°æ®çª—å£å¤§å°ï¼Œè¿™ä¸ªæ•°æ®çª—å£å¤§å°å¯èƒ½ä¼šéšç€è¡Œçš„å˜åŒ–è€Œå˜åŒ–ï¼Œ</p>
<p>ç¤ºä¾‹æ•°æ®ï¼š</p>
<img src="\img\QQæˆªå›¾20210312144133.png" alt="QQæˆªå›¾20210312144133" style="zoom:80%;">

<p>ç¬¬ä¸€å¤§ç±»ï¼š<strong>èšåˆå¼€çª—å‡½æ•°</strong>====ã€‹èšåˆå‡½æ•°(åˆ—) OVER (é€‰é¡¹)</p>
<p>ï¼šsum(),count()ç­‰éƒ½å¯ä»¥æ‹¼æ¥</p>
<p>ç¬¬äºŒå¤§ç±»ï¼š<strong>æ’åºå¼€çª—å‡½æ•°</strong>====ã€‹æ’åºå‡½æ•°(åˆ—) OVER(é€‰é¡¹)</p>
<p>ï¼šrank(),row_number()ç­‰éœ€è¦å’Œoverä¸€èµ·ä½¿ç”¨æ’åºå‡½æ•°</p>
<p><em><strong>ä¸é™äºæ­¤ï¼Œå¾ˆå¤šå‡½æ•°éƒ½å¯ä»¥é…åˆoverï¼ˆï¼‰ï¼Œåœ¨è¿™é‡Œä¸åšè¿‡å¤šä»‹ç»</strong></em></p>
<p>è¯­æ³•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--select å‡½æ•°å()over(partition by éœ€è¦åˆ†åŒºçš„åˆ—å order by æƒ³æ’åºçš„åˆ—å rows/range </span></span><br><span class="line"> <span class="comment">--unbounded preceding and unbouned followingé’ˆå¯¹å½“å‰æ‰€æœ‰è®°å½•çš„å‰ä¸€æ¡ã€åä¸€æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¡¨ä¸­çš„æ‰€æœ‰è®°å½•</span></span><br><span class="line">            <span class="comment">--unboundedï¼šä¸å—æ§åˆ¶çš„ï¼Œæ— é™çš„</span></span><br><span class="line">            <span class="comment">--precedingï¼šåœ¨...ä¹‹å‰</span></span><br><span class="line">            <span class="comment">--followingï¼šåœ¨...ä¹‹å</span></span><br><span class="line">          <span class="comment">--  BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) from è¡¨å</span></span><br><span class="line"><span class="comment">--such as </span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>,<span class="built_in">sum</span>(sage)<span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> sage <span class="keyword">rows</span> <span class="keyword">between</span> UNBOUNDED preceding <span class="keyword">and</span> UNBOUNDED following)</span><br><span class="line"><span class="keyword">from</span> &quot;student&quot;</span><br></pre></td></tr></table></figure>

<p><strong>åˆ†åŒºï¼ˆpartition by ï¼‰ï¼š</strong></p>
<p>åŠŸèƒ½ä¸group byå‡ ä¹ç›¸åŒï¼Œä½†group byå¯¹äºèšåˆçš„åˆ†ç»„åªæ˜¾ç¤ºä¸€è¡Œæ•°æ®ï¼Œå¹¶ä¸”selectåçš„å­—æ®µå¦‚æœå…¶ä¸­ä¸€ä¸ªè¢«group byï¼Œé‚£ä¹ˆå…¶ä»–å­—æ®µè¦ä¹ˆæ˜¯èšåˆå‡½æ•°è¦ä¹ˆä¹Ÿè¢«group byåˆ†ç»„èšåˆã€‚</p>
<p>æ —å­ï¼šåˆ†åˆ«æ±‚ç”·å¥³åŒå­¦å¹´é¾„æ€»å’Œ</p>
<img src="\img\QQæˆªå›¾20210315093653.png" alt="QQæˆªå›¾20210315093653" style="zoom:80%;">

<p>è€Œèšåˆå‡½æ•°æ­é…overï¼ˆï¼‰å¯ä»¥ä¸€ç»„è¿”å›å¤šè¡Œæ•°æ®ï¼Œè€Œä¸”å…¶ä»–å­—æ®µä¸éœ€è¦ä¸ºè¢«åˆ†ç»„æˆ–è¢«èšåˆã€‚</p>
<p><strong>æ’åºï¼ˆorder byï¼‰ï¼š</strong></p>
<p>æ —å­ï¼šç”·å¥³åˆ†åˆ«æ ¹æ®å¹´é¾„é™åºæ’åˆ—</p>
<img src="\img\QQæˆªå›¾20210315100337.png" alt="QQæˆªå›¾20210315100337" style="zoom:80%;">



<p>æ²¡ä»€ä¹ˆéœ€è¦å¤šè¯´çš„ï¼Œè¿™é‡Œä½¿ç”¨äº†rank()å‡½æ•°æ’åºï¼Œpartition byç›¸å½“äºgroup byï¼Œorder byè¿˜æ˜¯åŸæ„ã€‚</p>
<p>æ³¨ï¼šå…³äºrank()ç­‰æ’åºå‡½æ•°è¯·ç§»æ­¥å…¶ä»–æ–‡ç« ï¼Œæœ¬æ–‡ä¸åšè¯´æ˜</p>
<p>æ —å­iiï¼šç”·å¥³æŒ‰ç…§å¹´é¾„é™åºåˆ†åˆ«æ±‚å‡ºå¹´é¾„ç´¯è®¡</p>
<img src="\img\QQæˆªå›¾20210315135813.png" alt="QQæˆªå›¾20210315135813" style="zoom:80%;">

<p>è¿™é‡Œå‘ç”Ÿäº†å˜åŒ–ï¼Œå½“ä½¿ç”¨sum()æˆ–count()é…åˆoverä½¿ç”¨ï¼Œå¹¶ä¸”ä½¿ç”¨partition byå’Œorder byï¼Œå°±ä¼šæ ¹æ®æ’åºè¿›è¡Œé€æ¸çš„ç´¯åŠ æˆ–è€…æ±‚å’Œï¼Œå¯ä»¥ç”¨äºè®¡ç®—å„ä¸ªæœˆä»½éšæ—¶é—´ç´¯è®¡æ•°ç­‰æƒ…å†µ</p>
<p><strong>çª—å£ï¼ˆrows/rangeï¼‰æ³¨ï¼šrowså¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯rangeæ²¡ç ”ç©¶æ˜ç™½æŠ¥é”™ï¼š</strong></p>
<p>åœ¨Overå­å¥ä¸­ï¼Œä½¿ç”¨Rows æˆ–Range è¿›ä¸€æ­¥é™åˆ¶åˆ†åŒºçš„æ•°æ®è¡Œï¼Œåœ¨ä½¿ç”¨æ—¶ï¼Œå¿…é¡»æ³¨æ„ï¼š</p>
<p>å¿…éœ€æ¡ä»¶ï¼šå¦‚æœä½¿ç”¨Rows æˆ– Rangeå¿…é¡»è·Ÿåœ¨Order by å­å¥ä¹‹åï¼Œå¯¹æ’åºçš„ç»“æœè¿›è¡Œé™åˆ¶ï¼›<br>Rowsï¼šä½¿ç”¨å›ºå®šçš„è¡Œæ•°æ¥é™åˆ¶åˆ†åŒºä¸­çš„æ•°æ®è¡Œæ•°é‡ï¼›The ROWS clause limits the rows within a partition by specifying a fixed number of rows preceding or following the current row.<br>Rangeï¼šä½¿ç”¨Valueçš„èŒƒå›´æ¥é™åˆ¶åˆ†åŒºä¸­çš„æ•°æ®è¡Œæ•°é‡ï¼Œæ’åºåˆ—çš„é‡å¤å€¼ï¼Œè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå€¼ï¼›The RANGE clause logically limits the rows within a partition by specifying a range of values with respect to the value in the current row.<br>åœ¨åˆ†åŒºä¸­ï¼Œå¦‚æœæ’åºè¡Œä¸å­˜åœ¨é‡å¤å€¼ï¼ŒRowså’ŒRangeè¿”å›çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼›å¦‚æœæ’åºè¡Œå­˜å‚¨åœ¨é‡å¤å€¼ï¼ŒRowså’ŒRangeè¿”å›çš„ç»“æœå¯èƒ½ä¸åŒï¼›<br>Rangeå­å¥åªèƒ½ä»åˆ†åŒºçš„å¼€å§‹æˆ–ç»“å°¾åˆ°å½“å‰è¡Œå¼€å§‹è®¡ç®—ï¼Œä¸èƒ½ä½¿ç”¨ <uint_number> PRECEDING å’Œ<uint_number>  FOLLOWINGï¼›<br>ä½¿ç”¨åœ¨Rows å’Œ Rangeå­å¥ä¸­çš„ç‰¹æ®Šå…³é”®å­—ï¼š</uint_number></uint_number></p>
<p>UNBOUNDED PRECEDINGï¼šæŒ‡å®šåˆ†åŒºçš„ç¬¬ä¸€è¡Œ<br>UNBOUNDED FOLLOWINGï¼šæŒ‡å®šåˆ†åŒºçš„æœ€åä¸€è¡Œ<br>CURRENT ROWï¼šæŒ‡å®šåˆ†åŒºçš„å½“å‰æ•°æ®è¡Œ<br><uint_number> PRECEDINGï¼šåœ¨åˆ†åŒºä¸­ï¼ŒæŒ‡å®šå½“å‰è¡Œä¹‹å‰çš„æ•°æ®è¡Œæ•°é‡ï¼ŒUINT_Numberæ˜¯&gt;=0çš„æ•´æ•°<br><uint_number> FOLLOWINGï¼šåœ¨åˆ†åŒºä¸­ï¼ŒæŒ‡å®šå½“å‰è¡Œä¹‹åçš„æ•°æ®è¡Œæ•°é‡ï¼ŒUINT_Numberæ˜¯&gt;=0çš„æ•´æ•°</uint_number></uint_number></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--æ¯è¡Œæ•°æ®éƒ½ä¼šè¢«å¼€çª—å½±å“ï¼Œæ¯è¡Œæ•°æ®éƒ½ä¼šæ ¹æ®å¼€çª—çš„è¡Œæ•°æ¥å‘ä¸Šæˆ–å‘ä¸‹è¿›è¡Œå‡½æ•°çš„æ“ä½œã€‚</span></span><br><span class="line"><span class="comment">--å½“ä¸Šé¢æ²¡æœ‰è¡Œæ—¶ä¸Šé¢çš„è¡Œä¸åšå½±å“ï¼Œä¸‹é¢ä¹Ÿæ²¡æœ‰è¡Œæ—¶åŒä¸Šã€‚</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>,<span class="built_in">sum</span>(sage)<span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> sage <span class="keyword">rows</span> <span class="keyword">between</span> å‰å¤šå°‘è¡Œ preceding <span class="keyword">and</span> åå¤šå°‘è¡Œ following)</span><br><span class="line"><span class="keyword">from</span> &quot;student&quot;</span><br></pre></td></tr></table></figure>

<p>æ —å­ï¼šå¯¹åˆ†åŒºä¸­çš„è¿ç»­ä¸¤è¡Œè®¡ç®—åŠ å’Œï¼Œå°†æ¯è¡Œå’Œä¸‹ä¸€è¡Œè¿›è¡Œç›¸åŠ </p>
<img src="\img\QQæˆªå›¾20210315150441.png" alt="QQæˆªå›¾20210315150441" style="zoom:80%;">

<p>ç¬¬ä¸€è¡Œ=ç¬¬ä¸€è¡Œsage+ç¬¬äºŒè¡Œsageï¼Œç¬¬äºŒè¡Œ=ç¬¬äºŒè¡Œsage+ç¬¬ä¸‰è¡Œsageâ€¦â€¦â€¦..ä»¥æ­¤ç±»æ¨</p>
<p>å›¾ä¸­ç¬¬äº”è¡Œæ•°æ®å’Œç¬¬åè¡Œæ•°æ®éƒ½æ˜¯åˆ†åŒºä¸­çš„æœ€åä¸€è¡Œæ•°æ®ï¼Œæ²¡æœ‰ä¸‹é¢çš„è¡Œè¿›è¡Œç›¸åŠ æ‰€ä»¥æ˜¯åŸæ•°</p>
<p>â€“æ —å­iiï¼šå¯¹åˆ†åŒºä¸­çš„å½“å‰è¡Œå‘ä¸‹è®¡ç®—åŠ å’Œï¼Œå°†æ¯è¡Œåˆ°å½“å‰åˆ†åŒºæœ€åº•ä¸‹çš„è¿›è¡Œç›¸åŠ </p>
<p>Could not execute â€˜select *,sum(sage)over(order by sage range between unbounded preceding and unbounded following) â€¦â€™<br>SAP DBTech JDBC: [7]: feature not supported: Window frame specification of RANGE not allowed for this window function: line 1 col 10 (at pos 9)</p>
<img src="\img\202005241421367251716257711.500x0.jpg.webp" alt="202005241421367251716257711.500x0.jpg.webp">

<h1><span id="to-be-continuedå¤šåŠæ˜¯é¸½äº†"><strong><u><em>to</em> <em>be</em> continuedï¼ˆå¤šåŠæ˜¯é¸½äº†ğŸ˜œ </u></strong></span></h1>

        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/sql/" rel="tag">sql</a><a class="tag-none-link" href="/tags/study/" rel="tag">study</a>
            </div>
        

    </section>
</article>

  
    
<article class="post ">

    
        <h2 class="title">
            <a href="/2021/03/12/%E6%8E%92%E5%BA%8F%E5%87%BD%E6%95%B0/">
                æ’åºå‡½æ•°
            </a>
        </h2>
    
    <time>
        3æœˆ 12, 2021
    </time>
    <section class="content">
        <h5><span id="æ’åºå‡½æ•°">æ’åºå‡½æ•°ï¼š</span></h5><p>  æ’åºå‡½æ•°çš„ä½œç”¨æ˜¯åŸºäºä¸€ä¸ªç»“æœé›†è¿”å›ä¸€ä¸ªæ’åºå€¼ã€‚æ’åºå€¼å°±æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¿™ä¸ªæ•°å­—æ˜¯å…¸å‹çš„ä»¥1å¼€å§‹ä¸”è‡ªå¢é•¿ä¸º1çš„è¡Œå€¼ã€‚ç”±æ’åºå‡½æ•°æ¥å†³å®šæ’åºå€¼ã€‚å¯ä»¥ä½¿å”¯ä¸€çš„å¯¹äºå½“å‰ç»“æœé›†ï¼Œæˆ–è€…æŸäº›è¡Œæ•°æ®æœ‰ç›¸åŒçš„æ’åºå€¼ã€‚æ¥ä¸‹æ¥ä»‹ç»ä¸åŒçš„æ’åºå‡½æ•°ä»¥åŠå¦‚ä½•ä½¿ç”¨è¿™äº›å‡½æ•°ã€‚</p>
<p>ç¤ºä¾‹æ•°æ®ï¼š</p>
<img src="\img\QQæˆªå›¾20210312144133.png" alt="QQæˆªå›¾20210312144133" style="zoom:80%;">

<p>è¯­æ³•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--select å‡½æ•°å()over(order by æƒ³æ’åºçš„åˆ—å) from è¡¨å</span></span><br><span class="line"><span class="comment">--such as </span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">rank</span>()<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> ssex <span class="keyword">order</span> <span class="keyword">by</span> sage <span class="keyword">desc</span>) </span><br><span class="line"><span class="keyword">from</span> &quot;student&quot;</span><br></pre></td></tr></table></figure>

<p><em>æ³¨ï¼šoverï¼ˆï¼‰å¼€çª—å‡½æ•°ç”¨æ³•åœ¨æ­¤æ–‡ä¸­ä¸è¿›è¡Œä»‹ç»</em></p>
<h6><span id="row_number"><strong>ROW_NUMBER()</strong></span></h6><p><strong>å®šä¹‰</strong>ï¼šROW_NUMBER()å‡½æ•°ä½œç”¨å°±æ˜¯å°†selectæŸ¥è¯¢åˆ°çš„æ•°æ®è¿›è¡Œæ’åºï¼Œæ¯ä¸€æ¡æ•°æ®åŠ ä¸€ä¸ªåºå·ï¼Œä»–ä¸èƒ½ç”¨åšäºå­¦ç”Ÿå¹´é¾„çš„æ’åï¼Œä¸€èˆ¬å¤šç”¨äºåˆ†é¡µæŸ¥è¯¢ï¼Œå› ä¸ºåœ¨é‡åˆ°ç›¸åŒå¹´é¾„æ—¶åºå·ä¾ç„¶ä¼šç»§ç»­è‡ªå¢ï¼Œè€Œéå¹¶åˆ—çš„åºå·ã€‚</p>
<p><strong>æ —å­ï¼š</strong>æ ¹æ®å¹´é¾„é™åºæ’åˆ—å­¦ç”Ÿ</p>
<img src="\img\QQæˆªå›¾20210312145034.png" alt="QQæˆªå›¾20210312145034" style="zoom:80%;">

<p>ROW_NUMBERï¼ˆï¼‰å½“é‡åˆ°ç›¸åŒå¹´é¾„æ—¶åºå·ä¾ç„¶ä¼šè‡ªå¢</p>
<h6><span id="rank"><strong>RANK()</strong></span></h6><p><strong>å®šä¹‰ï¼š</strong>RANK()å‡½æ•°ï¼Œé¡¾åæ€ä¹‰æ’åå‡½æ•°ï¼Œå¯ä»¥å¯¹æŸä¸€ä¸ªå­—æ®µè¿›è¡Œæ’åï¼Œä¸ROW_NUMBER()ä¸åŒï¼Œå½“å­˜åœ¨ç›¸åŒå¹´é¾„çš„å­¦ç”Ÿæ—¶ï¼ŒROW_NUMBER()ä¼šç»§ç»­è¿›è¡Œæ’åºï¼Œä»–ä»¬çš„åºå·ä¸ç›¸åŒï¼Œè€ŒRank()åˆ™ä¸ä¸€æ ·ï¼Œå½“å‡ºç°ç›¸åŒçš„å¹´é¾„æ—¶ï¼Œä»–ä»¬çš„æ’åæ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸”ä¼šè·³è¿‡å·²ç»å ç”¨çš„åºå·ã€‚</p>
<p><strong>æ —å­ï¼š</strong>æ ¹æ®å¹´é¾„é™åºæ’åˆ—å­¦ç”Ÿ</p>
<img src="\img\QQæˆªå›¾20210312145927.png" alt="QQæˆªå›¾20210312145927" style="zoom:80%;">

<p><em>è¿™é‡Œç¬¬äº”æ¡æ•°æ®çªç„¶ä»2å·åºå·è·³è·ƒåˆ°5å·åºå·ï¼Œæ˜¯å› ä¸ºä¸Šé¢å·²ç»æœ‰å››ä½åŒå­¦è¢«æ’åºè¿‡ï¼ŒæŒ‰ç…§å·²ç»è¢«æ’åºçš„æ•°æ®æ¡æ•°å°±æ˜¯5å·</em></p>
<p>RANKï¼ˆï¼‰å½“é‡åˆ°ç›¸åŒå¹´é¾„æ—¶åºå·æ—¶åºå·ä¸ä¼šè‡ªå¢ï¼Œè€Œæ˜¯å’Œç›¸åŒå¹´é¾„æ—¶çš„åºå·ç›¸åŒã€‚åŒæ—¶å½“å†æ¬¡å‘ä¸‹æ’åºé‡åˆ°ä¸åŒå¹´é¾„æ—¶ï¼Œä¼šæ ¹æ®å·²è¿›è¡Œæ’åºçš„æ¡æ•°æ¥è·³è·ƒåºå·ã€‚</p>
<h6><span id="dense_rank"><strong>DENSE_RANK()</strong></span></h6><p><strong>å®šä¹‰</strong>ï¼šDENSE_RANK()å‡½æ•°ä¹Ÿæ˜¯æ’åå‡½æ•°ï¼Œå’ŒRANK()åŠŸèƒ½ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯å¯¹å­—æ®µè¿›è¡Œæ’åï¼Œé‚£å®ƒå’ŒRANK()åˆ°åº•æœ‰ä»€ä¹ˆä¸åŒé‚£ï¼Ÿ</p>
<p><strong>æ —å­ï¼š</strong>æ ¹æ®å¹´é¾„é™åºæ’åˆ—å­¦ç”Ÿ</p>
<img src="\img\QQæˆªå›¾20210312150624.png" alt="QQæˆªå›¾20210312150624" style="zoom:80%;">

<p>dense_rankå‡½æ•°çš„åŠŸèƒ½ä¸rankå‡½æ•°ç±»ä¼¼ï¼Œdense_rankå‡½æ•°åœ¨ç”Ÿæˆåºå·æ—¶æ˜¯è¿ç»­çš„ï¼Œè€Œrankå‡½æ•°ç”Ÿæˆçš„åºå·æœ‰å¯èƒ½ä¸è¿ç»­ã€‚dense_rankå‡½æ•°å‡ºç°ç›¸åŒæ’åæ—¶ï¼Œå°†ä¸è·³è¿‡ç›¸åŒæ’åå·ï¼Œrankå€¼ç´§æ¥ä¸Šä¸€æ¬¡çš„rankå€¼ã€‚åœ¨å„ä¸ªåˆ†ç»„å†…ï¼Œrank()æ˜¯è·³è·ƒæ’åºï¼Œæœ‰ä¸¤ä¸ªç¬¬ä¸€åæ—¶æ¥ä¸‹æ¥å°±æ˜¯ç¬¬å››åï¼Œdense_rank()æ˜¯è¿ç»­æ’åºï¼Œæœ‰ä¸¤ä¸ªç¬¬ä¸€åæ—¶ä»ç„¶è·Ÿç€ç¬¬äºŒåã€‚</p>
<p><strong>NTILE()</strong></p>
<p><strong>å®šä¹‰</strong>ï¼šntileå‡½æ•°å¯ä»¥å¯¹åºå·è¿›è¡Œåˆ†ç»„å¤„ç†ï¼Œå°†æœ‰åºåˆ†åŒºä¸­çš„è¡Œåˆ†å‘åˆ°æŒ‡å®šæ•°ç›®çš„ç»„ä¸­ã€‚ å„ä¸ªç»„æœ‰ç¼–å·ï¼Œç¼–å·ä»ä¸€å¼€å§‹ã€‚ å¯¹äºæ¯ä¸€ä¸ªè¡Œï¼Œntile å°†è¿”å›æ­¤è¡Œæ‰€å±çš„ç»„çš„ç¼–å·ã€‚è¿™å°±ç›¸å½“äºå°†æŸ¥è¯¢å‡ºæ¥çš„è®°å½•é›†æ”¾åˆ°æŒ‡å®šé•¿åº¦çš„æ•°ç»„ä¸­ï¼Œæ¯ä¸€ä¸ªæ•°ç»„å…ƒç´ å­˜æ”¾ä¸€å®šæ•°é‡çš„è®°å½•ã€‚ntileå‡½æ•°ä¸ºæ¯æ¡è®°å½•ç”Ÿæˆçš„åºå·å°±æ˜¯è¿™æ¡è®°å½•æ‰€æœ‰çš„æ•°ç»„å…ƒç´ çš„ç´¢å¼•ï¼ˆä»1å¼€å§‹ï¼‰ã€‚ä¹Ÿå¯ä»¥å°†æ¯ä¸€ä¸ªåˆ†é…è®°å½•çš„æ•°ç»„å…ƒç´ ç§°ä¸ºâ€œæ¡¶â€ã€‚ntileå‡½æ•°æœ‰ä¸€ä¸ªå‚æ•°ï¼Œç”¨æ¥æŒ‡å®šæ¡¶æ•°ã€‚</p>
<img src="\img\QQæˆªå›¾20210312160137.png" alt="QQæˆªå›¾20210312160137" style="zoom:80%;">

<p><em>å°†å¹´é¾„é™åºå¹¶ä¸”å¹³å‡åˆ†ä¸ºå››ä¸ªæ¡¶ï¼ˆåŒºï¼‰</em></p>
<p>ã€€ã€€ntileå‡½æ•°çš„åˆ†ç»„ä¾æ®ï¼ˆçº¦å®šï¼‰ï¼š</p>
<p>ã€€ã€€<strong>1ã€æ¯ç»„çš„è®°å½•æ•°ä¸èƒ½å¤§äºå®ƒä¸Šä¸€ç»„çš„è®°å½•æ•°ï¼Œå³ç¼–å·å°çš„æ¡¶æ”¾çš„è®°å½•æ•°ä¸èƒ½å°äºç¼–å·å¤§çš„æ¡¶ã€‚å°±æ˜¯è¯´ï¼Œç¬¬1ç»„ä¸­çš„è®°å½•æ•°åªèƒ½å¤§äºç­‰äºç¬¬2ç»„åŠä»¥åå„ç»„ä¸­çš„è®°å½•æ•°ã€‚</strong></p>
<p>ã€€ã€€<strong>2ã€æ‰€æœ‰ç»„ä¸­çš„è®°å½•æ•°è¦ä¹ˆéƒ½ç›¸åŒï¼Œè¦ä¹ˆä»æŸä¸€ä¸ªè®°å½•è¾ƒå°‘çš„ç»„ï¼ˆå‘½åä¸ºXï¼‰å¼€å§‹åé¢æ‰€æœ‰ç»„çš„è®°å½•æ•°éƒ½ä¸è¯¥ç»„ï¼ˆXç»„ï¼‰çš„è®°å½•æ•°ç›¸åŒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæœ‰ä¸ªç»„ï¼Œå‰ä¸‰ç»„çš„è®°å½•æ•°éƒ½æ˜¯9ï¼Œè€Œç¬¬å››ç»„çš„è®°å½•æ•°æ˜¯8ï¼Œé‚£ä¹ˆç¬¬äº”ç»„å’Œç¬¬å…­ç»„çš„è®°å½•æ•°ä¹Ÿå¿…é¡»æ˜¯8ã€‚</strong></p>
<p>ä»¥ä¸Šä¸ºå››ä¸ªæ’åºå‡½æ•°çš„ç”¨æ³•ï¼Œæœ€åä¸€ä¸ªå¯èƒ½ä¸ç®—æ’åºï¼Œè€Œæ˜¯æ ¹æ®æ’åºå†…å®¹åˆ†æ¡¶ï¼Œåº”ç”¨åœºæ™¯ä¸€èˆ¬ä¸ä¸ºæ’åºã€‚è€Œè¿™äº›æ’åºå‡½æ•°éƒ½ä¾èµ–äºoveråˆ†çª—å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°æ’åºéƒ½æ˜¯åœ¨å®ƒä¹‹ä¸­è¿›è¡Œçš„ï¼ŒåŒæ—¶å®ƒä¹Ÿå¯ä»¥ä½¿ç”¨partition byæ’åºçš„åŒæ—¶åˆ†ç»„ï¼Œç±»ä¼¼äºgroup byï¼Œä¹Ÿå¯ä»¥æ ¹æ®rowå’Œrangeè¿›è¡Œå¼€çª—ï¼Œä½†è¿™é‡Œä¸è¿‡å¤šè§£é‡Šã€‚ï¼</p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p>åœ¨ä½¿ç”¨æ’åå‡½æ•°çš„æ—¶å€™éœ€è¦æ³¨æ„ä»¥ä¸‹ä¸‰ç‚¹ï¼š</p>
<p>ã€€ã€€1ã€æ’åå‡½æ•°å¿…é¡»æœ‰ OVER å­å¥ã€‚</p>
<p>ã€€ã€€2ã€æ’åå‡½æ•°å¿…é¡»æœ‰åŒ…å« ORDER BY çš„ OVER å­å¥ã€‚</p>
<p>ã€€ã€€3ã€åˆ†ç»„å†…ä»1å¼€å§‹æ’åºã€‚</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/52XF/p/4209211.html">å¼•è‡ª[Sql å››å¤§æ’åå‡½æ•°ï¼ˆROW_NUMBERã€RANKã€DENSE_RANKã€NTILEï¼‰ç®€ä»‹]</a></p>
<img src="\img\20200429013947.52ff80ba8cacf5780b8e9e93e02e02ef.png" alt="20200429013947.52ff80ba8cacf5780b8e9e93e02e02ef" style="zoom:33%;">



        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/sql/" rel="tag">sql</a><a class="tag-none-link" href="/tags/study/" rel="tag">study</a>
            </div>
        

    </section>
</article>

  
</section>


        <script>setLoadingBarProgress(60);</script>
    </main>

    <footer id="footer" class="clearfix">

    

    <div class="social-wrapper">
        
            
                <a href="https://github.com/artchen" class="social github"
                   target="_blank" rel="external">
                    <span class="icon icon-github"></span>
                </a>
            
                <a href="/atom.xml" class="social rss"
                   target="_blank" rel="external">
                    <span class="icon icon-rss"></span>
                </a>
            
        
    </div>

    <div class="theme-by">Theme <span class="codename">Memory</span> designed by <a href="https://artifact.me/"
                                                                                    target="_blank">Art Chen</a>.
    </div>
    <div>&copy; <a href="/">å®…è°ˆ</a></div>

</footer>


    <script>setLoadingBarProgress(80);</script>
    <div class="overlay"></div>
</div>

<div class="site-sidebar" id="site-sidebar">

    

    <div class="sidebar-switch clearfix "
         style="display: none">
        <a class="dark-btn active" data-toggle="toc">
            <span class="icon icon-list"></span>
            <span class="text">Index</span>
        </a>
        <a class="dark-btn" data-toggle="bio">
            <span class="icon icon-person"></span>
            <span class="text">Bio</span>
        </a>
    </div>

    <div class="site-toc "
         style="display: none">
        
            <div class="no-index">No Index</div>
        
    </div>

    <div class="site-bio show"
         style="display: block">

        <div class="about-me clearfix">
            <div class="avatar">
                <img src="/img/avatar.png"/>
            </div>
            <div class="info">
                <a class="name dark-btn" href="/about">
                    Freere-Aoki
                </a>
            </div>
            <div class="info">
                <span class="item desc">
                    ä½ è¿˜åœ¨æœŸå¾…ç€ä»€ä¹ˆï¼Ÿ
                </span>
            </div>
        </div>

        <div class="menu section">
            <ul class="clearfix">
                
                    <li class="left">
                        <a href="/about"
                           onfocus="this.blur();"
                           class="nav-ä¿ºæ§˜ã â• dark-btn block">
                            About
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/archives"
                           onfocus="this.blur();"
                           class="nav-å›³æ›¸é¤¨ dark-btn block">
                            Archives
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/header"
                           onfocus="this.blur();"
                           class="nav-ä¿ºã®é ­ dark-btn block">
                            Header
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/gunName"
                           onfocus="this.blur();"
                           class="nav-é»‘è‰²é­…å½± dark-btn block">
                            GunName
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/Links"
                           onfocus="this.blur();"
                           class="nav-å‹äººå¸ dark-btn block">
                            LINKS
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/rolex/ä¸»é¡µ"
                           onfocus="this.blur();"
                           class="nav-åŠ³åŠ›å£« dark-btn block">
                            Rolex
                        </a>
                    </li>
                
            </ul>
        </div>

    </div>

    <div class="shortcuts">
        <a href="#header" class="top window-nav dark-btn" id="go-top">
            <span class="icon icon-chevron-thin-up"></span>
        </a>
        <a class="close dark-btn" id="sidebar-close">
            <span class="icon icon-close"></span>
        </a>
        <a href="#footer" class="top window-nav dark-btn" id="go-bottom">
            <span class="icon icon-chevron-thin-down"></span>
        </a>
    </div>

</div>





<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>window.jQuery || document.write('<script src="/js/jquery.min.js"><\/script>')</script>


<script src="/js/jquery.fitvids.js"></script>

<script>
  var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
  var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
  var ALGOLIA_API_KEY = "";
  var ALGOLIA_APP_ID = "";
  var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var SEARCH_SERVICE = "";
  var universalSearchConfig = {};
  if (SEARCH_SERVICE === 'google') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      apiKey: GOOGLE_CUSTOM_SEARCH_API_KEY,
      engineId: GOOGLE_CUSTOM_SEARCH_ENGINE_ID,
      imagePath: "/img/"
    };
  } else if (SEARCH_SERVICE === 'algolia') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      apiKey: ALGOLIA_API_KEY,
      appId: ALGOLIA_APP_ID,
      indexName: ALGOLIA_INDEX_NAME,
      imagePath: "/img/"
    };
  } else if (SEARCH_SERVICE === 'azure') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      serviceName: AZURE_SERVICE_NAME,
      indexName: AZURE_INDEX_NAME,
      apiKey: AZURE_QUERY_KEY,
      imagePath: "/img/"
    };
  }
</script>

<script src="/js/app.js"></script>


<script src="/js/search.js"></script>





<script>setLoadingBarProgress(100);</script>

</body>
</html>
